
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.1.0",
    "react-dom/": "https://esm.sh/react-dom@^19.1.0/",
    "react/": "https://esm.sh/react@^19.1.0/",
    "@google/genai": "https://esm.sh/@google/genai@^1.2.0",
    "react-markdown": "https://esm.sh/react-markdown@9.0.1?bundle",
    "remark-gfm": "https://esm.sh/remark-gfm@4.0.0?bundle"
  }
}
</script>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company Intranet - Dashboard (React)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        :root {
            --font-primary: 'Inter', sans-serif;
            
            --color-bg-deep-dark: #0a0a0f;
            --color-bg-dark: #12121c;
            /* Adjusted for frost effect & more transparency */
            --color-glass-bg: rgba(35, 35, 50, 0.45); 
            --color-glass-border: rgba(200, 200, 255, 0.08); /* Softer border for more transparency */
            --color-glass-border-active: rgba(120, 140, 255, 0.4);

            --color-text-primary: #e0e0e0;
            --color-text-secondary: #a0a0b0;
            --color-text-disabled: #606070;
            --color-text-error: #f87171;

            --color-accent-primary: #6c63ff;
            --color-accent-secondary: #54d0dd;
            --color-accent-primary-rgb: 108, 99, 255;
            --color-accent-secondary-rgb: 84, 208, 221;
            
            --color-btc: #f7931a;
            --color-eth: #627eea;
            --color-positive: #4ade80;
            --color-negative: #f87171;

            --shadow-light: rgba(0, 0, 0, 0.1);
            --shadow-medium: rgba(0, 0, 0, 0.25);
            --shadow-deep: rgba(0,0,0,0.35);

            --border-radius-sm: 6px;
            --border-radius-md: 10px;
            --border-radius-lg: 16px;

            --chat-bubble-size: 56px;
            --chat-bubble-expanded-width: 380px;
            --chat-bubble-expanded-height: 550px;

            --widget-spacing: 1.5rem; /* Adjusted spacing */
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            font-size: 16px; 
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-primary);
            background-color: var(--color-bg-deep-dark);
            color: var(--color-text-primary);
            display: flex;
            height: 100vh;
            width: 100vw;
            overflow: hidden; 
            line-height: 1.6;
        }
        
        @keyframes subtleShiftingGlow {
            0% { opacity: 0.5; transform: scale(1) translate(0, 0); }
            25% { opacity: 0.4; transform: scale(1.02) translate(8px, -8px); } 
            50% { opacity: 0.5; transform: scale(1) translate(0, 0); }
            75% { opacity: 0.4; transform: scale(1.02) translate(-8px, 8px); } 
            100% { opacity: 0.5; transform: scale(1) translate(0, 0); }
        }

        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: 
                radial-gradient(circle at 10% 20%, rgba(var(--color-accent-primary-rgb), 0.12), transparent 55%), 
                radial-gradient(circle at 90% 80%, rgba(var(--color-accent-secondary-rgb), 0.12), transparent 55%); 
            z-index: -1;
            pointer-events: none;
            animation: subtleShiftingGlow 60s ease-in-out infinite; 
        }

        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: rgba(10,10,15,0.15); border-radius: 4px;}
        ::-webkit-scrollbar-thumb { background: var(--color-text-disabled); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--color-text-secondary); }
        * { scrollbar-width: thin; scrollbar-color: var(--color-text-disabled) rgba(10,10,15,0.15); }

        /* Global Focus Visible Style */
        *:focus-visible {
            outline: 2px solid var(--color-accent-secondary);
            outline-offset: 2px;
            box-shadow: 0 0 0 4px rgba(var(--color-accent-secondary-rgb), 0.3);
        }
        /* Remove default outline for elements with custom focus styles from other rules */
        .glass-panel:focus-within, .glass-panel.active-focus,
        .wiki-search-bar input[type="text"]:focus,
        .wiki-page-form .form-group input[type="text"]:focus,
        .wiki-page-form .form-group textarea:focus,
        .chat-input-area textarea:focus,
        .nav-links .nav-item a:focus, .nav-footer .nav-item a:focus,
        .user-actions .icon-button:focus,
        .widget-header-button:focus,
        .wiki-header .button-primary:focus,
        .wiki-search-bar button:focus,
        .wiki-page-display-header .action-buttons button:focus,
        .wiki-page-form .form-actions button:focus,
        .chat-bubble-header button:focus,
        .chat-input-area button:focus,
        .chat-bubble-icon:focus-visible,
        .toggle-switch input:focus-visible + .toggle-switch-slider,
        .stat-item:focus-visible /* Added for new component */
         {
            outline: none;
        }
        /* Specific focus-visible for nav items if needed, e.g., to slightly adjust the generic one */
        .nav-links .nav-item a:focus-visible, .nav-footer .nav-item a:focus-visible {
            outline: 2px solid var(--color-accent-secondary); /* Or a different color for nav */
            outline-offset: 1px; /* Adjust to better fit the rounded shape */
            box-shadow: 0 0 0 3px rgba(var(--color-accent-secondary-rgb), 0.25);
        }
        /* Ensure buttons get a clear focus visible that might have been overridden */
        button:focus-visible, input[type="button"]:focus-visible, input[type="submit"]:focus-visible {
             outline: 2px solid var(--color-accent-secondary);
             outline-offset: 2px;
             box-shadow: 0 0 0 4px rgba(var(--color-accent-secondary-rgb), 0.3);
        }


        .glass-panel {
            background-color: var(--color-glass-bg);
            backdrop-filter: blur(22px) saturate(110%); /* Slightly adjusted for new transparency */
            -webkit-backdrop-filter: blur(22px) saturate(110%);
            border: 1px solid var(--color-glass-border);
            border-radius: var(--border-radius-lg);
            box-shadow: 0 10px 28px -10px var(--shadow-deep), 
                        inset 0 0.5px 0px 0 rgba(255, 255, 255, 0.04), /* Even softer inner highlight */
                        0 0 0 0.5px var(--color-glass-border); 
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .glass-panel:focus-within, .glass-panel.active-focus { 
             border-color: var(--color-glass-border-active);
             box-shadow: 0 10px 28px -10px var(--shadow-deep),
                        inset 0 0.5px 0px 0 rgba(255, 255, 255, 0.04),
                        0 0 0 0.5px var(--color-glass-border-active), 
                        0 0 0 2.5px rgba(var(--color-accent-primary-rgb), 0.25); 
        }


        .app-container {
            display: flex;
            width: 100%;
            height: 100%;
        }

        .left-navigation {
            width: 240px; 
            min-width: 240px;
            height: calc(100% - 2rem);
            margin: 1rem;
            padding: 1.25rem 1rem; 
            display: flex;
            flex-direction: column;
            transition: width 0.3s ease, transform 0.3s ease;
        }

        .nav-header {
            display: flex;
            align-items: center;
            padding: 0 0.5rem 1.25rem 0.5rem; 
            margin-bottom: 1rem;
            border-bottom: 1px solid var(--color-glass-border);
        }

        .nav-header .logo {
            font-size: 1.5rem; 
            font-weight: 700;
            color: var(--color-text-primary);
            letter-spacing: 1px;
        }
         .nav-header .logo-accent { color: var(--color-accent-primary); }


        .nav-links {
            list-style: none;
            flex-grow: 1;
        }

        .nav-links .nav-item a, .nav-footer .nav-item a {
            display: flex;
            align-items: center;
            padding: 0.7rem 0.9rem; 
            margin-bottom: 0.4rem; 
            border-radius: var(--border-radius-md);
            color: var(--color-text-secondary);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9rem; 
            transition: background-color 0.2s ease, color 0.2s ease, box-shadow 0.2s ease;
        }
        .nav-links .nav-item svg, .nav-footer .nav-item svg { 
            width: 18px; height: 18px; 
            margin-right: 0.9rem; 
            opacity: 0.7;
            transition: opacity 0.2s ease;
            vertical-align: middle; 
            flex-shrink: 0;
        }
        .nav-links .nav-item .nav-label, .nav-footer .nav-item .nav-label {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex-grow: 1; /* Allow label to take space */
        }


        .nav-links .nav-item a:hover, .nav-footer .nav-item a:hover {
            background-color: rgba(255, 255, 255, 0.07); 
            color: var(--color-text-primary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        .nav-links .nav-item a:hover svg, .nav-footer .nav-item a:hover svg {
            opacity: 1;
        }

        .nav-links .nav-item.active a, .nav-footer .nav-item.active a,
        .nav-links .nav-item.chat-bubble-active a { /* Style for active chat bubble toggle */
            background-color: var(--color-accent-primary);
            color: #fff;
            box-shadow: 0 5px 15px rgba(var(--color-accent-primary-rgb), 0.35); 
        }
        .nav-links .nav-item.active a svg, .nav-footer .nav-item.active a svg,
        .nav-links .nav-item.chat-bubble-active a svg {
            opacity: 1;
        }
        
        .nav-footer {
            padding: 1rem 0.5rem;
            margin-top: auto;
            border-top: 1px solid var(--color-glass-border);
        }
        .nav-footer ul { list-style: none; }
        .nav-footer .nav-item a { 
            font-size: 0.85rem; 
        }

        /* Low Memory Mode Toggle Styles */
        .low-memory-toggle-item {
            display: flex;
            align-items: center;
            justify-content: space-between; /* To align label and switch */
            padding: 0.7rem 0.9rem;
            margin-bottom: 0.4rem;
            color: var(--color-text-secondary);
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: var(--border-radius-md);
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        .low-memory-toggle-item:hover {
            background-color: rgba(255, 255, 255, 0.07);
            color: var(--color-text-primary);
        }
        .low-memory-toggle-item .nav-label { /* Re-use nav-label for consistency */
            margin-right: auto; /* Pushes switch to the right */
        }
        .toggle-switch-container {
            display: flex;
            align-items: center;
            position: relative;
        }
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 38px; /* Width of the switch */
            height: 20px; /* Height of the switch */
            background-color: rgba(255, 255, 255, 0.15);
            border-radius: 20px; /* Fully rounded */
            transition: background-color 0.3s ease;
        }
        .toggle-switch-slider {
            position: absolute;
            cursor: pointer;
            top: 2px;
            left: 2px;
            width: 16px; /* Diameter of the slider */
            height: 16px;
            background-color: var(--color-text-secondary);
            border-radius: 50%;
            transition: transform 0.3s ease, background-color 0.3s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .toggle-switch input:checked + .toggle-switch-slider {
            transform: translateX(18px); /* Moves slider to the right: width - slider_width - 2*offset */
            background-color: var(--color-accent-primary);
        }
        .toggle-switch input:focus-visible + .toggle-switch-slider {
            box-shadow: 0 0 0 2px var(--color-bg-deep-dark), 0 0 0 4px var(--color-accent-secondary);
        }
        /* Active state for the toggle background when checked */
        .toggle-switch input:checked ~ .toggle-switch-background { /* If using a separate background div inside .toggle-switch */
            background-color: rgba(var(--color-accent-primary-rgb), 0.3);
        }


        .dashboard-area {
            flex-grow: 1;
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow-y: auto; 
            padding: 1rem 1rem 1rem 0; 
        }
        
        .dashboard-header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1.5rem; 
            margin: 0 0 var(--widget-spacing) 0; 
            height: 64px; 
            flex-shrink: 0;
            /* Applying glass panel effect */
            background-color: var(--color-glass-bg);
            backdrop-filter: blur(26px) saturate(120%);
            -webkit-backdrop-filter: blur(26px) saturate(120%);
            border: 1px solid var(--color-glass-border);
            border-radius: var(--border-radius-lg);
            box-shadow: 0 10px 25px -8px var(--shadow-deep), 
                        inset 0 1px 0.5px 0 rgba(255, 255, 255, 0.06),
                        0 0 0 1px var(--color-glass-border);
        }


        .dashboard-header-bar h1 {
            font-size: 1.6rem; 
            font-weight: 600;
            color: var(--color-text-primary);
        }

        .user-actions { display: flex; align-items: center; gap: 0.8rem; } 
        .user-actions .icon-button {
            background: rgba(255,255,255,0.08); 
            border: 1px solid var(--color-glass-border);
            color: var(--color-text-secondary);
            width: 38px; height: 38px; 
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: all 0.2s ease;
        }
        .user-actions .icon-button:hover {
            background: rgba(255,255,255,0.12);
            color: var(--color-text-primary);
            border-color: var(--color-glass-border-active);
            transform: translateY(-1px); 
        }
        .user-actions .icon-button svg { width: 18px; height: 18px; } 
        .user-actions .user-avatar {
            width: 38px; height: 38px; border-radius: 50%; 
            background-color: var(--color-accent-primary);
            color: white; display: flex; align-items: center; justify-content: center;
            font-weight: 600; font-size: 0.9rem; cursor: pointer; 
        }

        /* Old WidgetsGrid and Widget Styles (kept for reference or other views, but dashboard uses new HorizontalStatsBar) */
        .widgets-grid {
            display: grid;
            grid-template-columns: 1fr; 
            gap: var(--widget-spacing); 
            padding: 0 1.5rem 1.5rem 1.5rem; 
            flex-grow: 1;
        }
        .widget {
            padding: 1.5rem;
            min-height: auto; 
            display: flex;
            flex-direction: column;
        }
        .widget.long-tile-widget { padding: 1.75rem; }
        .widget.compact-highlight-widget { padding: 1rem; }
        .widget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem; 
        }
        .widget-header-button {
            background-color: rgba(255, 255, 255, 0.08);
            color: var(--color-text-secondary);
            border: 1px solid var(--color-glass-border);
            padding: 0.25rem 0.6rem; 
            border-radius: var(--border-radius-sm);
            font-size: 0.75rem; 
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .widget-header-button:hover {
            background-color: rgba(255, 255, 255, 0.12);
            color: var(--color-text-primary);
            border-color: var(--color-glass-border-active);
        }
         .widget-header-button:disabled { cursor: not-allowed; opacity: 0.6; }
        .widget-header h3 {
            font-size: 1.1rem; 
            font-weight: 600;
            color: var(--color-text-primary);
        }
        .compact-highlight-widget .widget-header h3 { font-size: 0.95rem; }
        .widget-header .widget-icon { color: var(--color-accent-secondary); margin-left: auto; }
        .widget-header .widget-icon svg { width: 20px; height: 20px; } 
        .compact-highlight-widget .widget-header .widget-icon svg { width: 18px; height: 18px; }
        .widget-content {
            flex-grow: 1;
            font-size: 0.9rem; 
            color: var(--color-text-secondary);
            position: relative; 
            display: flex; 
            flex-direction: column; 
            gap: 0.75rem; 
        }
        .compact-highlight-widget .widget-content { font-size: 0.8rem; gap: 0.5rem; }
        .widget-content .loading-state, .widget-content .error-state {
            position: absolute; 
            top: 0; left: 0; right: 0; bottom: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: rgba(var(--color-glass-bg),0.8); 
            border-radius: 0 0 var(--border-radius-lg) var(--border-radius-lg); 
            padding: 1rem; text-align: center; z-index: 1;
        }
        .widget-content .loading-state svg {
            width: 28px; height: 28px; margin-bottom: 0.5rem; 
            animation: spin 1s linear infinite;
            color: var(--color-accent-primary);
        }
        .widget-content .error-state svg {
            width: 28px; height: 28px; margin-bottom: 0.5rem; 
            color: var(--color-text-error);
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* Horizontal Stats Bar Styles */
        .horizontal-stats-bar-container {
            padding: 0 1.5rem 1.5rem 1.5rem; /* Match old widgets-grid padding */
        }
        .horizontal-stats-bar {
            display: flex;
            justify-content: space-around; /* Distribute items evenly */
            align-items: center;
            gap: 1rem; /* Space between stat items */
            padding: 1rem; /* Padding inside the bar */
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
        }
        .stat-item {
            background-color: var(--color-glass-bg);
            backdrop-filter: blur(18px) saturate(100%);
            -webkit-backdrop-filter: blur(18px) saturate(100%);
            border: 1px solid var(--color-glass-border);
            border-radius: var(--border-radius-md);
            padding: 0.75rem 1rem; /* Smaller padding for compact items */
            display: flex;
            align-items: center;
            gap: 0.75rem; /* Space between icon and text */
            min-width: 180px; /* Minimum width for each item */
            box-shadow: 0 4px 12px -4px var(--shadow-medium),
                        inset 0 0.5px 0px 0 rgba(255, 255, 255, 0.03);
            transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
        }
        .stat-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px -4px var(--shadow-deep),
                        inset 0 0.5px 0px 0 rgba(255, 255, 255, 0.03);
        }
        .stat-item:focus-visible { /* Custom focus for stat items */
            border-color: var(--color-glass-border-active);
            box-shadow: 0 0 0 2.5px rgba(var(--color-accent-secondary-rgb), 0.3),
                        0 6px 16px -4px var(--shadow-deep),
                        inset 0 0.5px 0px 0 rgba(255, 255, 255, 0.03);
        }
        .stat-item-icon {
            flex-shrink: 0;
        }
        .stat-item-icon svg {
            width: 24px; /* Smaller icon */
            height: 24px;
            color: var(--color-accent-secondary); /* Default icon color */
        }
        .stat-item-info {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .stat-item-value {
            font-size: 1.25rem; /* Prominent value */
            font-weight: 600;
            color: var(--color-text-primary);
            line-height: 1.1;
        }
        .stat-item-label {
            font-size: 0.75rem; /* Smaller label */
            color: var(--color-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }


        #file-protocol-warning-react-container { }
        .file-protocol-warning-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background-color: rgba(10, 10, 15, 0.95); 
            color: var(--color-text-primary, #e0e0e0); 
            display: flex; flex-direction: column; 
            align-items: center; justify-content: center; 
            font-family: var(--font-primary, 'Inter', sans-serif); 
            padding: 20px; box-sizing: border-box; z-index: 10000; text-align: center;
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
        }
        .file-protocol-warning-content {
            background-color: var(--color-bg-dark, #12121c); 
            padding: 2rem 3rem; 
            border-radius: var(--border-radius-lg, 16px); 
            border: 1px solid var(--color-glass-border, rgba(200, 200, 255, 0.1)); 
            box-shadow: 0 8px 32px 0 var(--shadow-medium, rgba(0,0,0,0.25)); 
            max-width: 700px;
        }
        .file-protocol-warning-content h1 { color: var(--color-text-error, #f87171); font-size: 1.8rem; margin-bottom: 1rem; }
        .file-protocol-warning-content p { font-size: 1rem; line-height: 1.6; margin-bottom: 1rem; }
        .file-protocol-warning-content h2 { font-size: 1.2rem; margin-bottom: 0.75rem; color: var(--color-accent-secondary, #54d0dd); }
        .file-protocol-warning-content ul { list-style-position: inside; text-align: left; padding-left: 1rem; margin-bottom: 1.5rem; margin-left: auto; margin-right:auto; }
        .file-protocol-warning-content li { margin-bottom: 0.5rem; }
        .file-protocol-warning-content code { background: var(--color-bg-deep-dark, #0a0a0f); padding: 2px 5px; border-radius: 4px; color: var(--color-text-primary, #e0e0e0); }
        .file-protocol-warning-content a { color: var(--color-accent-primary, #6c63ff); font-weight: bold; }
        .file-protocol-warning-content .subtext { font-size: 0.85rem; color: var(--color-text-secondary, #a0a0b0); }

        .initial-loading-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background-color: var(--color-bg-deep-dark); 
            display: flex; align-items: center; justify-content: center; 
            z-index: 9999;
        }
        .initial-loading-overlay svg { width: 50px; height: 50px; color: var(--color-accent-primary); animation: spin 1s linear infinite; }

        /* Wiki View General Styles */
        .view-container { /* Generic container for views like Wiki, Interaction Log */
            display: flex; flex-direction: column; height: 100%;
            padding: 0 1.5rem 1.5rem 1.5rem; gap: 1.25rem; 
        }
        .view-header { /* Generic header for views */
            display: flex; justify-content: space-between; align-items: center;
            padding: 1rem 0; border-bottom: 1px solid var(--color-glass-border); flex-shrink: 0;
        }
        .view-header .view-title-group {
            display: flex; align-items: center; gap: 0.75rem;
        }
        .view-header .view-title-group .view-icon svg {
             width: 28px; height: 28px; color: var(--color-accent-secondary);
        }
        .view-header h1 { font-size: 1.8rem; font-weight: 600; color: var(--color-text-primary); }
        
        /* Wiki Specific Header Button */
        .wiki-header .button-primary {
            background-color: var(--color-accent-primary); color: white; border: none;
            padding: 0.5rem 1rem; border-radius: var(--border-radius-md); 
            font-weight: 500; cursor: pointer; transition: background-color 0.2s ease;
            display: flex; align-items: center; gap: 0.5rem;
        }
        .wiki-header .button-primary:hover { background-color: #5a52e0; }
        .wiki-header .button-primary svg { width: 16px; height: 16px; } 

        .wiki-search-bar {
            display: flex; gap: 0.5rem; margin-bottom: 1rem; flex-shrink: 0;
            /* Applying glass panel effect */
            padding: 0.75rem;
            background-color: var(--color-glass-bg);
            backdrop-filter: blur(26px) saturate(120%);
            -webkit-backdrop-filter: blur(26px) saturate(120%);
            border: 1px solid var(--color-glass-border);
            border-radius: var(--border-radius-lg);
            box-shadow: 0 8px 20px -5px var(--shadow-deep), inset 0 1px 0.5px rgba(255,255,255,0.06);
        }
        .wiki-search-bar input[type="text"] {
            flex-grow: 1; padding: 0.65rem 0.9rem; background-color: rgba(255, 255, 255, 0.08); 
            border: 1px solid var(--color-glass-border); border-radius: var(--border-radius-md);
            color: var(--color-text-primary); font-size: 0.95rem; 
        }
        .wiki-search-bar input[type="text"]:focus {
            border-color: var(--color-glass-border-active);
            box-shadow: 0 0 0 2px rgba(var(--color-accent-primary-rgb), 0.3);
        }
        .wiki-search-bar button {
            padding: 0.65rem 1.1rem; background-color: var(--color-accent-secondary); 
            color: var(--color-bg-deep-dark); border: none; border-radius: var(--border-radius-md);
            font-weight: 500; cursor: pointer; transition: background-color 0.2s ease;
        }
        .wiki-search-bar button:hover { background-color: #4ac0ca; }
        .wiki-search-bar button:disabled { background-color: var(--color-text-disabled); cursor: not-allowed; }

        .wiki-content-area { display: flex; gap: 1.25rem; flex-grow: 1; overflow: hidden; } 
        .wiki-search-results, .wiki-page-form-container { 
            width: 320px; min-width: 280px; overflow-y: auto; padding: 1rem; 
        }
        .wiki-search-results ul { list-style: none; }
        .wiki-search-results li {
            padding: 0.65rem 0.9rem; margin-bottom: 0.4rem; background-color: rgba(255,255,255,0.04); 
            border: 1px solid var(--color-glass-border); border-radius: var(--border-radius-sm);
            cursor: pointer; transition: background-color 0.2s ease, border-color 0.2s ease;
        }
        .wiki-search-results li:hover { background-color: rgba(255,255,255,0.08); border-color: var(--color-glass-border-active); }
        .wiki-search-results li .result-title { font-weight: 600; color: var(--color-text-primary); font-size: 0.9rem; } 
        .wiki-search-results li .result-score { font-size: 0.75rem; color: var(--color-text-disabled); margin-left: 0.5rem; } 
        .wiki-search-results .no-results { text-align: center; padding: 1.5rem 0; color: var(--color-text-secondary); font-size: 0.9rem;} 

        .wiki-page-display, .wiki-page-form-container { 
             flex-grow: 1; overflow-y: auto; padding: 1.25rem; 
        }
        .wiki-page-display-header {
             display: flex; justify-content: space-between; align-items: center;
             margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid var(--color-glass-border);
        }
        .wiki-page-display-header h2 { font-size: 1.4rem; color: var(--color-text-primary); } 
        .wiki-page-display-header .action-buttons { display: flex; gap: 0.5rem; }
        .wiki-page-display-header .action-buttons button, .wiki-page-form .form-actions button {
            background-color: transparent; border: 1px solid var(--color-glass-border);
            color: var(--color-text-secondary); padding: 0.35rem 0.7rem; border-radius: var(--border-radius-sm); 
            cursor: pointer; transition: all 0.2s ease; font-size: 0.8rem; 
            display: flex; align-items: center; gap: 0.4rem;
        }
        .wiki-page-display-header .action-buttons button svg, .wiki-page-form .form-actions button svg { width: 14px; height: 14px;} 
        .wiki-page-display-header .action-buttons button:hover, .wiki-page-form .form-actions button:hover {
            border-color: var(--color-glass-border-active); color: var(--color-text-primary);
        }
        .wiki-page-form .form-actions button.primary {
            background-color: var(--color-accent-primary); color: white; border-color: var(--color-accent-primary);
        }
        .wiki-page-form .form-group { margin-bottom: 0.9rem; } 
        .wiki-page-form .form-group label { display: block; margin-bottom: 0.4rem; font-weight: 500; font-size: 0.85rem; } 
        .wiki-page-form .form-group input[type="text"], 
        .wiki-page-form .form-group textarea {
            width: 100%; padding: 0.65rem 0.9rem; background-color: rgba(255, 255, 255, 0.08); 
            border: 1px solid var(--color-glass-border); border-radius: var(--border-radius-md);
            color: var(--color-text-primary); font-size: 0.9rem; 
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .wiki-page-form .form-group input[type="text"]:focus,
        .wiki-page-form .form-group textarea:focus {
            border-color: var(--color-glass-border-active);
            box-shadow: 0 0 0 2px rgba(var(--color-accent-primary-rgb), 0.3);
        }
        .wiki-page-form .form-group textarea { min-height: 120px; resize: vertical; } 
        .wiki-page-form .form-actions { margin-top: 1.25rem; display: flex; justify-content: flex-end; gap: 0.6rem; } 

        /* Styles for react-markdown rendered content in Wiki */
        .wiki-page-content { font-size: 0.95rem; line-height: 1.7; }
        .wiki-page-content h1, .wiki-page-content h2, .wiki-page-content h3,
        .wiki-page-content h4, .wiki-page-content h5, .wiki-page-content h6 {
            color: var(--color-text-primary);
            margin-top: 1.5em;
            margin-bottom: 0.75em;
            padding-bottom: 0.25em;
            border-bottom: 1px solid var(--color-glass-border);
            font-weight: 600;
        }
        .wiki-page-content h1 { font-size: 1.8em; }
        .wiki-page-content h2 { font-size: 1.5em; }
        .wiki-page-content h3 { font-size: 1.25em; }
        .wiki-page-content p { margin-bottom: 1em; }
        .wiki-page-content ul, .wiki-page-content ol {
            margin-bottom: 1em;
            padding-left: 1.5em;
        }
        .wiki-page-content li { margin-bottom: 0.4em; }
        .wiki-page-content blockquote {
            margin: 1em 0;
            padding: 0.5em 1em;
            border-left: 3px solid var(--color-accent-secondary);
            background-color: rgba(var(--color-accent-secondary-rgb), 0.05);
            color: var(--color-text-secondary);
        }
        .wiki-page-content code {
            background-color: rgba(255,255,255,0.1);
            padding: 0.2em 0.4em;
            border-radius: var(--border-radius-sm);
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
            font-size: 0.85em;
        }
        .wiki-page-content pre {
            background-color: rgba(0,0,0,0.2);
            padding: 1em;
            border-radius: var(--border-radius-md);
            overflow-x: auto;
            margin-bottom: 1em;
        }
        .wiki-page-content pre code {
            background-color: transparent;
            padding: 0;
            font-size: 0.85em;
            line-height: 1.5;
        }
        .wiki-page-content a {
            color: var(--color-accent-secondary);
            text-decoration: none;
        }
        .wiki-page-content a:hover { text-decoration: underline; }
        .wiki-page-content table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1em;
            border: 1px solid var(--color-glass-border);
        }
        .wiki-page-content th, .wiki-page-content td {
            border: 1px solid var(--color-glass-border);
            padding: 0.5em 0.75em;
            text-align: left;
        }
        .wiki-page-content th {
            background-color: rgba(255,255,255,0.05);
            font-weight: 600;
        }
        .wiki-page-content img { max-width: 100%; height: auto; border-radius: var(--border-radius-sm); margin: 0.5rem 0; }


        /* Chat Bubble Styles */
        .chat-bubble-wrapper {
            position: fixed;
            z-index: 1000;
            transition: width 0.3s ease, height 0.3s ease, border-radius 0.3s ease, box-shadow 0.3s ease;
            cursor: grab;
        }
        .chat-bubble-wrapper.dragging {
            cursor: grabbing;
            transition: none; /* Disable transition while dragging for smoother movement */
        }
        .chat-bubble-icon {
            width: var(--chat-bubble-size);
            height: var(--chat-bubble-size);
            border-radius: 50%;
            background-color: var(--color-accent-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 20px rgba(var(--color-accent-primary-rgb), 0.4);
            transition: transform 0.2s ease-out;
        }
        .chat-bubble-icon:hover {
            transform: scale(1.1);
        }
        .chat-bubble-icon svg {
            width: 28px;
            height: 28px;
            color: white;
        }

        .chat-bubble-expanded {
            width: var(--chat-bubble-expanded-width);
            height: var(--chat-bubble-expanded-height);
            max-height: 80vh; /* Max height relative to viewport */
            border-radius: var(--border-radius-lg);
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Important for containing children */
        }
        .chat-bubble-header {
            padding: 0.5rem 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: rgba(0,0,0,0.15); /* Slightly darker for header */
            border-bottom: 1px solid var(--color-glass-border);
            flex-shrink: 0;
            cursor: grab; /* Header is also draggable */
        }
        .chat-bubble-header h4 {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--color-text-primary);
        }
        .chat-bubble-header button {
            background: none;
            border: none;
            color: var(--color-text-secondary);
            cursor: pointer;
            padding: 0.25rem;
        }
        .chat-bubble-header button:hover {
            color: var(--color-text-primary);
        }
        .chat-bubble-header button svg {
            width: 16px;
            height: 16px;
        }
        
        /* ChatViewContainer when inside bubble */
        .chat-bubble-expanded .chat-view-container {
            padding: 0; /* Remove outer padding as bubble provides it */
            flex-grow: 1; /* Allow it to fill the bubble */
            height: auto; /* Let flexbox determine height */
             display: flex;
            flex-direction: column;
            overflow: hidden; /* This is important */
        }
        .chat-bubble-expanded .chat-header {
            display: none; /* Hide original header from ChatViewContainer */
        }

        .chat-bubble-expanded .chat-messages-area {
            flex-grow: 1;
            padding: 0.75rem; /* Adjusted padding */
            margin: 0; /* Remove margin if any */
            border-radius: 0; /* No border radius inside the bubble */
            border: none; /* No border inside bubble */
            box-shadow: none; /* No box shadow inside bubble */
            background-color: transparent; /* Background handled by bubble */
            backdrop-filter: none; /* Backdrop filter handled by bubble */
            -webkit-backdrop-filter: none;
             max-height: calc(var(--chat-bubble-expanded-height) - 80px); /* Approx header and input height */
        }
        .chat-bubble-expanded .chat-input-area {
            padding: 0.75rem;
            margin: 0;
            border-radius: 0;
            border: none;
            border-top: 1px solid var(--color-glass-border); /* Separator line */
            box-shadow: none;
            background-color: transparent;
            backdrop-filter: none;
            -webkit-backdrop-filter: none;
            flex-shrink: 0;
        }
        .chat-bubble-expanded .chat-input-area textarea {
            font-size: 0.85rem; /* Slightly smaller for bubble */
            max-height: 80px; /* Limit textarea growth */
        }
        .chat-bubble-expanded .chat-input-area button {
            padding: 0.5rem 0.8rem;
            font-size: 0.85rem;
        }

        /* Chat Message Styles (mostly unchanged, might need slight tweaks if issues arise) */
        .chat-message {
            display: flex;
            max-width: 85%; /* Slightly more width for messages in bubble */
            padding: 0.5rem 0.8rem; 
            border-radius: var(--border-radius-md);
            line-height: 1.4; /* Adjusted line height */
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); 
            font-size: 0.85rem; /* Smaller font for bubble */
            margin-bottom: 0.5rem; /* Spacing between messages */
        }
        .chat-message.user-message {
            background-color: var(--color-accent-primary);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: var(--border-radius-sm);
        }
        .chat-message.ai-message {
            background-color: rgba(255, 255, 255, 0.12); 
            color: var(--color-text-primary);
            align-self: flex-start;
            border-bottom-left-radius: var(--border-radius-sm);
        }
        .message-content {
             white-space: pre-wrap; 
             word-break: break-word;
        }
        .message-timestamp {
            font-size: 0.65rem; /* Smaller timestamp */
            color: rgba(255,255,255,0.6);
            margin-left: 0.5rem;
            align-self: flex-end; /* Align timestamp to bottom of message bubble */
        }
        .user-message .message-timestamp {
             color: rgba(255,255,255,0.7);
        }
        .ai-typing-indicator {
            font-size: 0.8rem;
            color: var(--color-text-secondary);
            padding: 0.5rem 0.75rem;
            text-align: center;
            font-style: italic;
        }
        .chat-error-message {
            padding: 0.6rem 0.8rem;
            color: var(--color-text-error);
            background-color: rgba(var(--color-text-error-rgb, 248, 113, 113), 0.15); 
            border: 1px solid rgba(var(--color-text-error-rgb, 248, 113, 113), 0.3);
            border-radius: var(--border-radius-sm);
            margin: 0.5rem 0.75rem;
            font-size: 0.8rem;
            text-align: center;
        }
        /* Add fallback for --color-text-error-rgb if not defined */
        :root {
             --color-text-error-rgb: 248, 113, 113; /* Define if missing, from #f87171 */
        }

        .chat-messages-area .loading-state p,
        .chat-view-container .loading-state p { /* Ensure loading messages in chat are also smaller */
             font-size: 0.8rem;
        }

        .chat-input-area.disabled-input-area {
            opacity: 0.6;
            pointer-events: none; /* Prevent interactions */
        }
        .chat-input-area.disabled-input-area textarea {
            background-color: rgba(255,255,255,0.05); /* Slightly different background when disabled */
        }
        
        /* Interaction Log Styles */
        .interaction-log-view-container { /* Uses .view-container for base */
            /* Specific styles if needed */
        }
        .interaction-log-list {
            list-style: none;
            padding: 0;
            margin: 0;
            overflow-y: auto;
            flex-grow: 1;
        }
        .interaction-log-item {
            background-color: var(--color-glass-bg);
            border: 1px solid var(--color-glass-border);
            border-radius: var(--border-radius-md);
            padding: 1rem 1.25rem;
            margin-bottom: 1rem;
            box-shadow: 0 5px 15px -5px var(--shadow-medium);
        }
        .interaction-log-item:last-child {
            margin-bottom: 0;
        }
        .interaction-log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--color-glass-border);
        }
        .interaction-log-header .log-role {
            font-weight: 600;
            font-size: 0.95rem;
        }
        .interaction-log-header .log-role.user { color: var(--color-accent-secondary); }
        .interaction-log-header .log-role.ai { color: var(--color-accent-primary); }
        .interaction-log-header .log-timestamp {
            font-size: 0.75rem;
            color: var(--color-text-disabled);
        }
        .interaction-log-content {
            font-size: 0.9rem;
            line-height: 1.6;
            white-space: pre-wrap; /* Preserve whitespace and newlines */
            word-break: break-word;
        }
        .interaction-log-content strong { color: var(--color-text-primary); }
        .interaction-log-content pre { /* For XML/code snippets in log */
            background-color: rgba(0,0,0,0.25);
            padding: 0.75rem;
            border-radius: var(--border-radius-sm);
            overflow-x: auto;
            margin-top: 0.5rem;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
            font-size: 0.8em;
            color: var(--color-text-secondary);
        }
         .interaction-log-empty-state {
            text-align: center;
            padding: 2rem;
            color: var(--color-text-secondary);
        }


        #root {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <!-- 
      IMPORTANT: The script below loads index.tsx directly.
      This requires a development server (like Vite or Create React App's dev server)
      that can transpile TypeScript (.ts, .tsx) to JavaScript on the fly
      and handle ES module imports for local files.
      Opening this index.html directly via the file:/// protocol will likely
      result in errors like "Failed to resolve module specifier" because
      browsers do not natively execute TypeScript.
    -->
    <script type="module" src="/index.tsx"></script>
</body>
</html><link rel="stylesheet" href="index.css">
<script src="index.tsx" type="module"></script>
